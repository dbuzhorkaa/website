{{ define "main" }}
<div class="get-started">
  {{ partial "components/hero-panel" . }}

  <div class="container">

  </div>

  {{ $data := index .Site.Data .Site.Language.Lang }}
  <div class="tab-content">
    <div id="cloud-tab" class="tab-pane fade">
      {{ with $tabs := $data.get_started.cloud }}
      {{ range $tabs }}

      {{ range $index, $item := .evaluate }}
        {{ partial "components/get-started/services" (dict "context" . "index" $index) }}
      {{ end }}

      {{ range $index, $item := .onProduction }}
        {{ partial "components/get-started/services" (dict "context" . "index" $index) }}
      {{ end }}

      {{ end }}
      {{ end }}
    </div>
    <div id="premises-tab" class="tab-pane fade">
      {{ with $tabs := $data.get_started.onPremises }}
      {{ range $tabs }}
      {{ range $index, $item := .evaluate }}
      {{ $wrapper := $item.subTitle }}
        {{ partial "components/get-started/services" (dict "context" . "index" $index "wrapper" $wrapper "class" "premises") }}
      {{ end }}

      {{ range $index, $item := .onProduction }}
      {{ $wrapper := $item.subTitle }}
        {{ partial "components/get-started/services" (dict "context" . "index" $index "wrapper" $wrapper "class" "premises") }}
      {{ end }}

      {{ end }}
      {{ end }}
    </div>
  </div>
  {{ with $tabs := $data.get_started.resources }}
  {{ range $tabs }}
    {{ partial "components/get-started/resources" . }}
  {{ end }}
  {{ end }}
</div>

<script>
  const ctaBtns = document.querySelectorAll('.premises-services__button');
  const closeBtns = document.querySelectorAll('.get-started__close-wrapper');
  const dropdownEvaluationItems = document.querySelectorAll('.evaluation-nav-js');
  const dropdownProductionItems = document.querySelectorAll('.production-nav-js');
  const dropDownCta = document.querySelector('.dropdown-toggle');
  const panesEvaluation = document.querySelectorAll('.evaluation-wrapper-js');
  const panesProductuon = document.querySelectorAll('.production-wrapper-js');
  let persistBtnText = dropDownCta.innerText.trim();
  let datasetContext = {};

  function handleDropdownItemClick(items, panes, callback) {
    items.forEach(item => {
      item.addEventListener('click', function () {
        document.querySelector(`#dropdownBtn-${this.dataset.id}`).innerText = this.innerText;
        callback(panes, this);
      });
    });
  }

  function processOverlay(items, context) {
    items.forEach(item => {
      item.classList.remove('d-flex');
      if (context.dataset.id === item.dataset.reflect) {
        item.classList.add('d-flex');
      }
    });
  }

  handleDropdownItemClick(
    dropdownEvaluationItems,
    panesEvaluation,
    processOverlay
  );
  handleDropdownItemClick(
    dropdownProductionItems,
    panesProductuon,
    processOverlay,
  );

  function open() {
    ctaBtns.forEach(btn => {
      btn.addEventListener('click', function () {
        datasetContext = { linkId: this.dataset.linkId, wrapper: this.dataset.wrapper };
        if (datasetContext) {
          const button = document.querySelector(`#${datasetContext.linkId}`);
          if (button !== null) {
            button.classList.add('d-flex');
          }
          document.querySelector(`.${datasetContext.wrapper}-js`).classList.add('d-none');
        }
      });
    });
  }

  function close() {
    closeBtns.forEach(closeBtn => {
      closeBtn.addEventListener('click', function() {
        this.parentNode.classList.remove('d-flex');
        document.querySelector(`.${this.dataset.reflect}`).classList.remove('d-none');
        dropDownCta.innerText = persistBtnText;
      });
    });
  }

  open();
  close();
</script>

{{ end }}
